<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exam Paper Repository</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4f46e5;
            --primary-dark: #4338ca;
            --secondary: #14d192;
            --dark: #1e293b;
            --light: #f8fafc;
        }
        
        .card-hover {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .file-upload {
            border: 2px dashed #cbd5e1;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
        }
        
        .file-upload:hover {
            border-color: var(--primary);
            background-color: rgba(79, 70, 229, 0.05);
        }
        
        .admin-indicator {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 50;
        }
        
        .paper-card {
            min-height: 220px;
        }
        
        .paper-list-item {
            transition: background-color 0.2s ease;
        }
        
        .paper-list-item:hover {
            background-color: #f9fafb;
        }
        
        .file-upload-highlight {
            border-color: var(--primary);
            background-color: rgba(79, 70, 229, 0.05);
        }
        
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .toast.success {
            background-color: #10b981;
        }
        
        .toast.error {
            background-color: #ef4444;
        }
        
        .toast.info {
            background-color: #3b82f6;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>
    
    <!-- Admin Indicator -->
    <div class="admin-indicator">
        <button id="adminToggleBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg shadow flex items-center">
            <i class="fas fa-lock mr-2"></i> Admin Login
        </button>
    </div>

    <!-- Admin Login Modal -->
    <div id="adminLoginModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">Admin Login</h2>
            <div class="mb-4">
                <label class="block text-gray-700 mb-2">Password</label>
                <input type="password" id="adminPassword" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Enter password">
                <p id="passwordError" class="text-red-500 text-sm mt-1 hidden">Incorrect password. Try "pravat"</p>
            </div>
            <div class="flex justify-end">
                <button id="cancelLoginBtn" class="px-4 py-2 text-gray-600 hover:text-gray-800 mr-2">Cancel</button>
                <button id="loginBtn" class="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">Login</button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <header class="text-center mb-12">
            <h1 class="text-4xl font-bold text-gray-800 mb-3">Exam Paper Repository</h1>
            <p class="text-gray-600 max-w-2xl mx-auto">Search and download past exam papers from various colleges and courses. Administrators can manage content after login.</p>
        </header>

        <!-- Search Section -->
        <section class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6">
                <div>
                    <label class="block text-gray-700 mb-2">College</label>
                    <select id="collegeFilter" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <option value="">Select college</option>
                    </select>
                </div>
                <div>
                    <label class="block text-gray-700 mb-2">Course</label>
                    <select id="courseFilter" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" disabled>
                        <option value="">Select course</option>
                    </select>
                </div>
                <div>
                    <label class="block text-gray-700 mb-2">Year</label>
                    <select id="yearFilter" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <option value="">Select year</option>
                    </select>
                </div>
                <div>
                    <label class="block text-gray-700 mb-2">Semester</label>
                    <select id="semesterFilter" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <option value="">Select semester</option>
                        <option value="1">Semester 1</option>
                        <option value="2">Semester 2</option>
                        <option value="3">Semester 3</option>
                        <option value="4">Semester 4</option>
                    </select>
                </div>
                <div>
                    <label class="block text-gray-700 mb-2">Subject</label>
                    <select id="subjectFilter" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" disabled>
                        <option value="">Select subject</option>
                    </select>
                </div>
            </div>
            
            <div class="flex justify-between">
                <button id="resetFiltersBtn" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 flex items-center">
                    <i class="fas fa-redo mr-2"></i> Reset Filters
                </button>
                <div class="flex space-x-2">
                    <button id="searchBtn" class="px-4 py-2 bg-indigo-600 text-white rounded-lg flex items-center">
                        <i class="fas fa-search mr-2"></i> Search
                    </button>
                </div>
            </div>
        </section>

        <!-- View Toggle -->
        <div class="flex justify-end mb-4">
            <div class="inline-flex rounded-md shadow-sm" role="group">
                <button id="gridViewBtn" type="button" class="px-4 py-2 text-sm font-medium text-white bg-indigo-600 rounded-l-lg hover:bg-indigo-700 focus:z-10 focus:ring-2 focus:ring-indigo-500">
                    <i class="fas fa-th-large mr-2"></i> Grid View
                </button>
                <button id="listViewBtn" type="button" class="px-4 py-2 text-sm font-medium text-gray-900 bg-white border-t border-b border-gray-200 hover:bg-gray-100 hover:text-indigo-700 focus:z-10 focus:ring-2 focus:ring-indigo-500">
                    <i class="fas fa-list mr-2"></i> List View
                </button>
            </div>
        </div>

        <!-- Results Section -->
        <section id="resultsSection" class="mb-12">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">Available Exam Papers</h2>
            
            <!-- Grid View -->
            <div id="gridView" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Papers will be dynamically added here -->
            </div>
            
            <!-- List View -->
            <div id="listView" class="hidden bg-white rounded-xl shadow-md overflow-hidden">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Paper Title</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">College</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Course</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Year</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="listViewContent" class="bg-white divide-y divide-gray-200">
                        <!-- Papers will be dynamically added here -->
                    </tbody>
                </table>
            </div>
            
            <!-- No Results -->
            <div id="noResults" class="hidden">
                <div class="bg-white rounded-xl shadow-md p-12 text-center">
                    <div class="mx-auto max-w-md space-y-4">
                        <div class="bg-gray-200 border-2 border-dashed rounded-xl w-32 h-32 mx-auto"></div>
                        <h3 class="text-xl font-semibold">No papers found</h3>
                        <p class="text-gray-500">
                            Try adjusting your filters or search query
                        </p>
                        <button id="resetNoResultsBtn" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">
                            Reset Filters
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Admin Panel Section (Initially Hidden) -->
        <section id="adminPanel" class="hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">Admin Panel</h2>
                <button id="logoutBtn" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 flex items-center">
                    <i class="fas fa-sign-out-alt mr-2"></i> Logout
                </button>
            </div>
            
            <!-- Admin Tabs -->
            <div class="border-b border-gray-200 mb-6">
                <div class="flex space-x-4">
                    <button class="admin-tab active px-4 py-2 text-indigo-600 border-b-2 border-indigo-600 font-medium" data-tab="dashboard">Dashboard</button>
                    <button class="admin-tab px-4 py-2 text-gray-600 hover:text-gray-800" data-tab="colleges">Colleges</button>
                    <button class="admin-tab px-4 py-2 text-gray-600 hover:text-gray-800" data-tab="courses">Courses</button>
                    <button class="admin-tab px-4 py-2 text-gray-600 hover:text-gray-800" data-tab="subjects">Subjects</button>
                    <button class="admin-tab px-4 py-2 text-gray-600 hover:text-gray-800" data-tab="upload">Upload Papers</button>
                </div>
            </div>
            
            <!-- Tab Contents -->
            <div>
                <!-- Dashboard Tab -->
                <div id="dashboardTab" class="tab-content active">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div class="bg-white rounded-xl shadow-md p-6">
                            <div class="flex justify-between items-center">
                                <div>
                                    <h3 class="text-lg font-medium text-gray-700">Total Papers</h3>
                                    <p id="totalPapers" class="text-3xl font-bold text-gray-900 mt-2">0</p>
                                </div>
                                <div class="bg-indigo-100 p-3 rounded-full">
                                    <i class="fas fa-file-alt text-indigo-600 text-2xl"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-xl shadow-md p-6">
                            <div class="flex justify-between items-center">
                                <div>
                                    <h3 class="text-lg font-medium text-gray-700">Colleges</h3>
                                    <p id="totalColleges" class="text-3xl font-bold text-gray-900 mt-2">0</p>
                                </div>
                                <div class="bg-green-100 p-3 rounded-full">
                                    <i class="fas fa-university text-green-600 text-2xl"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-xl shadow-md p-6">
                            <div class="flex justify-between items-center">
                                <div>
                                    <h3 class="text-lg font-medium text-gray-700">Active Users</h3>
                                    <p class="text-3xl font-bold text-gray-900 mt-2">342</p>
                                </div>
                                <div class="bg-yellow-100 p-3 rounded-full">
                                    <i class="fas fa-users text-yellow-600 text-2xl"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-md p-6 mb-8">
                        <h3 class="text-lg font-medium text-gray-700 mb-4">Recent Uploads</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Paper Title</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">College</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Course</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                    </tr>
                                </thead>
                                <tbody id="recentUploads" class="bg-white divide-y divide-gray-200">
                                    <!-- Recent uploads will be added here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Colleges Tab -->
                <div id="collegesTab" class="tab-content">
                    <div class="bg-white rounded-xl shadow-md p-6 mb-8">
                        <h3 class="text-lg font-medium text-gray-700 mb-4">Manage Colleges</h3>
                        
                        <div class="mb-6">
                            <h4 class="text-md font-medium text-gray-700 mb-3">Add New College</h4>
                            <div class="flex space-x-2">
                                <input type="text" id="newCollegeName" placeholder="College Name" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                <button id="addCollegeBtn" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">Add College</button>
                            </div>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">College Name</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Courses</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="collegesTable" class="bg-white divide-y divide-gray-200">
                                    <!-- Colleges will be added here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Courses Tab -->
                <div id="coursesTab" class="tab-content">
                    <div class="bg-white rounded-xl shadow-md p-6 mb-8">
                        <h3 class="text-lg font-medium text-gray-700 mb-4">Manage Courses</h3>
                        
                        <div class="mb-6">
                            <h4 class="text-md font-medium text-gray-700 mb-3">Add New Course</h4>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                <div>
                                    <label class="block text-gray-700 mb-2">College</label>
                                    <select id="collegeForCourse" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                        <option value="">Select college</option>
                                    </select>
                                </div>
                                <div class="col-span-2">
                                    <label class="block text-gray-700 mb-2">Course Name</label>
                                    <input type="text" id="newCourseName" placeholder="Course Name" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                </div>
                            </div>
                            <button id="addCourseBtn" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">Add Course</button>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Course Name</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">College</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Subjects</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="coursesTable" class="bg-white divide-y divide-gray-200">
                                    <!-- Courses will be added here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Subjects Tab -->
                <div id="subjectsTab" class="tab-content">
                    <div class="bg-white rounded-xl shadow-md p-6 mb-8">
                        <h3 class="text-lg font-medium text-gray-700 mb-4">Manage Subjects</h3>
                        
                        <div class="mb-6">
                            <h4 class="text-md font-medium text-gray-700 mb-3">Add New Subject</h4>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                <div>
                                    <label class="block text-gray-700 mb-2">College</label>
                                    <select id="collegeForSubject" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                        <option value="">Select college</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-gray-700 mb-2">Course</label>
                                    <select id="courseForSubject" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" disabled>
                                        <option value="">Select course</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-gray-700 mb-2">Subject Name</label>
                                    <input type="text" id="newSubjectName" placeholder="Subject Name" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                </div>
                            </div>
                            <button id="addSubjectBtn" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">Add Subject</button>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Subject Name</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">College</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Course</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="subjectsTable" class="bg-white divide-y divide-gray-200">
                                    <!-- Subjects will be added here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Upload Papers Tab -->
                <div id="uploadTab" class="tab-content">
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <h3 class="text-lg font-medium text-gray-700 mb-4">Upload New Exam Paper</h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div>
                                <label class="block text-gray-700 mb-2">Paper Title</label>
                                <input type="text" id="paperTitle" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Enter paper title">
                            </div>
                            <div>
                                <label class="block text-gray-700 mb-2">College</label>
                                <select id="uploadCollege" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    <option value="">Select college</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-gray-700 mb-2">Course</label>
                                <select id="uploadCourse" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" disabled>
                                    <option value="">Select course</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-gray-700 mb-2">Subject</label>
                                <select id="uploadSubject" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" disabled>
                                    <option value="">Select subject</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-gray-700 mb-2">Year</label>
                                <select id="uploadYear" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    <option value="">Select year</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-gray-700 mb-2">Semester</label>
                                <select id="uploadSemester" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    <option value="">Select semester</option>
                                    <option value="1">Semester 1</option>
                                    <option value="2">Semester 2</option>
                                    <option value="3">Semester 3</option>
                                    <option value="4">Semester 4</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="mb-6">
                            <label class="block text-gray-700 mb-2">File Link</label>
                            <div class="flex space-x-2">
                                <input type="text" id="fileLink" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Enter file link (must include dl.surf)">
                                <button id="addFileBtn" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">Add File</button>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-4 mb-6">
                            <h4 class="text-md font-medium text-gray-700 mb-3">Preview</h4>
                            <div id="filePreview" class="bg-gray-50 p-4 rounded border border-gray-200">
                                <p class="text-gray-500 italic">No file added yet</p>
                            </div>
                        </div>
                        
                        <div class="flex justify-end">
                            <button id="uploadPaperBtn" class="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 flex items-center">
                                <i class="fas fa-upload mr-2"></i> Upload Paper
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <script>
        // Data storage
        const STORAGE_KEYS = {
            COLLEGES: 'exam_repo_colleges',
            COURSES: 'exam_repo_courses',
            SUBJECTS: 'exam_repo_subjects',
            PAPERS: 'exam_repo_papers',
            ADMIN_STATE: 'exam_repo_admin_state'
        };

        // Initialize data from localStorage or with defaults
        let colleges = JSON.parse(localStorage.getItem(STORAGE_KEYS.COLLEGES)) || [
            { id: 1, name: "Government College of Engineering" },
            { id: 2, name: "National Institute of Technology" },
            { id: 3, name: "University College of Engineering" },
            { id: 4, name: "Central Institute of Technology" }
        ];

        let courses = JSON.parse(localStorage.getItem(STORAGE_KEYS.COURSES)) || [
            { id: 1, collegeId: 1, name: "Computer Science Engineering" },
            { id: 2, collegeId: 1, name: "Mechanical Engineering" },
            { id: 3, collegeId: 2, name: "Electrical Engineering" },
            { id: 4, collegeId: 2, name: "Civil Engineering" },
            { id: 5, collegeId: 3, name: "Information Technology" },
            { id: 6, collegeId: 4, name: "Electronics Engineering" }
        ];

        let subjects = JSON.parse(localStorage.getItem(STORAGE_KEYS.SUBJECTS)) || [
            { id: 1, collegeId: 1, courseId: 1, name: "Data Structures" },
            { id: 2, collegeId: 1, courseId: 1, name: "Algorithms" },
            { id: 3, collegeId: 1, courseId: 2, name: "Thermodynamics" },
            { id: 4, collegeId: 2, courseId: 3, name: "Circuit Theory" },
            { id: 5, collegeId: 2, courseId: 4, name: "Structural Analysis" },
            { id: 6, collegeId: 3, courseId: 5, name: "Database Systems" },
            { id: 7, collegeId: 4, courseId: 6, name: "Digital Electronics" }
        ];

        let papers = JSON.parse(localStorage.getItem(STORAGE_KEYS.PAPERS)) || [
            { 
                id: 1, 
                title: "Data Structures Final Exam 2023", 
                collegeId: 1, 
                courseId: 1, 
                subjectId: 1, 
                year: 2023, 
                semester: 2, 
                file: "data_structures_2023.pdf",
                date: "2023-12-15",
                content: "This is the content of the Data Structures Final Exam 2023 paper. In a real application, this would be the actual exam paper content."
            },
            { 
                id: 2, 
                title: "Algorithms Midterm 2023", 
                collegeId: 1, 
                courseId: 1, 
                subjectId: 2, 
                year: 2023, 
                semester: 1, 
                file: "algorithms_midterm_2023.pdf",
                date: "2023-06-20",
                content: "This is the content of the Algorithms Midterm 2023 paper. In a real application, this would be the actual exam paper content."
            },
            { 
                id: 3, 
                title: "Thermodynamics Final 2022", 
                collegeId: 1, 
                courseId: 2, 
                subjectId: 3, 
                year: 2022, 
                semester: 2, 
                file: "thermodynamics_final_2022.pdf",
                date: "2022-12-10",
                content: "This is the content of the Thermodynamics Final 2022 paper. In a real application, this would be the actual exam paper content."
            }
        ];

        // Save data to localStorage
        function saveDataToStorage() {
            localStorage.setItem(STORAGE_KEYS.COLLEGES, JSON.stringify(colleges));
            localStorage.setItem(STORAGE_KEYS.COURSES, JSON.stringify(courses));
            localStorage.setItem(STORAGE_KEYS.SUBJECTS, JSON.stringify(subjects));
            localStorage.setItem(STORAGE_KEYS.PAPERS, JSON.stringify(papers));
        }

        // DOM elements
        const adminToggleBtn = document.getElementById('adminToggleBtn');
        const adminLoginModal = document.getElementById('adminLoginModal');
        const cancelLoginBtn = document.getElementById('cancelLoginBtn');
        const loginBtn = document.getElementById('loginBtn');
        const adminPassword = document.getElementById('adminPassword');
        const passwordError = document.getElementById('passwordError');
        const adminPanel = document.getElementById('adminPanel');
        const logoutBtn = document.getElementById('logoutBtn');
        const collegeFilter = document.getElementById('collegeFilter');
        const courseFilter = document.getElementById('courseFilter');
        const yearFilter = document.getElementById('yearFilter');
        const semesterFilter = document.getElementById('semesterFilter');
        const subjectFilter = document.getElementById('subjectFilter');
        const resetFiltersBtn = document.getElementById('resetFiltersBtn');
        const searchBtn = document.getElementById('searchBtn');
        const gridViewBtn = document.getElementById('gridViewBtn');
        const listViewBtn = document.getElementById('listViewBtn');
        const gridView = document.getElementById('gridView');
        const listView = document.getElementById('listView');
        const listViewContent = document.getElementById('listViewContent');
        const noResults = document.getElementById('noResults');
        const resetNoResultsBtn = document.getElementById('resetNoResultsBtn');
        const adminTabs = document.querySelectorAll('.admin-tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const totalPapers = document.getElementById('totalPapers');
        const totalColleges = document.getElementById('totalColleges');
        const recentUploads = document.getElementById('recentUploads');
        const newCollegeName = document.getElementById('newCollegeName');
        const addCollegeBtn = document.getElementById('addCollegeBtn');
        const collegesTable = document.getElementById('collegesTable');
        const collegeForCourse = document.getElementById('collegeForCourse');
        const newCourseName = document.getElementById('newCourseName');
        const addCourseBtn = document.getElementById('addCourseBtn');
        const coursesTable = document.getElementById('coursesTable');
        const collegeForSubject = document.getElementById('collegeForSubject');
        const courseForSubject = document.getElementById('courseForSubject');
        const newSubjectName = document.getElementById('newSubjectName');
        const addSubjectBtn = document.getElementById('addSubjectBtn');
        const subjectsTable = document.getElementById('subjectsTable');
        const paperTitle = document.getElementById('paperTitle');
        const uploadCollege = document.getElementById('uploadCollege');
        const uploadCourse = document.getElementById('uploadCourse');
        const uploadSubject = document.getElementById('uploadSubject');
        const uploadYear = document.getElementById('uploadYear');
        const uploadSemester = document.getElementById('uploadSemester');
        const fileLink = document.getElementById('fileLink');
        const addFileBtn = document.getElementById('addFileBtn');
        const filePreview = document.getElementById('filePreview');
        const uploadPaperBtn = document.getElementById('uploadPaperBtn');
        const toast = document.getElementById('toast');

        // Variables
        let selectedFile = null;
        let isAdminLoggedIn = localStorage.getItem(STORAGE_KEYS.ADMIN_STATE) === 'true' || false;

        // Show toast notification
        function showToast(message, type = 'success') {
            toast.textContent = message;
            toast.className = `toast show ${type}`;
            
            setTimeout(() => {
                toast.className = 'toast';
            }, 3000);
        }

        // Add file preview
        function addFile() {
            const name = paperTitle.value.trim();
            const link = fileLink.value.trim();
            
            if (!name || !link.includes('dl.surf')) {
                showToast('Please enter a valid title and dl.surf file link.', 'error');
                return;
            }
            
            filePreview.innerHTML = `
                <div class="bg-white shadow p-4 rounded-md border border-gray-200">
                    <h3 class="text-lg font-bold text-gray-800">üìÑ ${name}</h3>
                    <a href="${link}" target="_blank" class="text-blue-600 font-medium underline">‚¨áÔ∏è Download</a>
                </div>
            `;
            
            showToast('File added successfully!', 'success');
        }

        // Initialize the page
        function init() {
            // Initialize filters
            initFilters();
            
            // Initialize admin panel
            initAdminPanel();
            
            // Initialize view
            showGridView();
            
            // Update paper counts
            updatePaperCounts();
            
            // Show admin panel if already logged in
            if (isAdminLoggedIn) {
                adminPanel.classList.remove('hidden');
                adminToggleBtn.innerHTML = '<i class="fas fa-user-shield mr-2"></i> Admin Mode';
            }
            
            // Add event listeners
            addEventListeners();
            
            // Load initial papers
            loadPapers();
        }

        // Initialize filters
        function initFilters() {
            // Populate college filter
            colleges.forEach(college => {
                const option = document.createElement('option');
                option.value = college.id;
                option.textContent = college.name;
                collegeFilter.appendChild(option);
                
                // Clone for upload section
                const uploadOption = option.cloneNode(true);
                uploadCollege.appendChild(uploadOption);
                
                // Clone for admin sections
                collegeForCourse.appendChild(option.cloneNode(true));
                collegeForSubject.appendChild(option.cloneNode(true));
            });
            
            // Populate year filter
            const currentYear = new Date().getFullYear();
            for (let year = currentYear; year >= currentYear - 10; year--) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                yearFilter.appendChild(option);
                uploadYear.appendChild(option.cloneNode(true));
            }
        }

        // Initialize admin panel
        function initAdminPanel() {
            // Update counts
            totalPapers.textContent = papers.length;
            totalColleges.textContent = colleges.length;
            
            // Populate recent uploads
            const recent = papers.slice(0, 5).sort((a, b) => new Date(b.date) - new Date(a.date));
            recentUploads.innerHTML = '';
            recent.forEach(paper => {
                const college = colleges.find(c => c.id === paper.collegeId);
                const course = courses.find(c => c.id === paper.courseId);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${paper.title}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${college ? college.name : 'N/A'}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${course ? course.name : 'N/A'}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${paper.date}</td>
                `;
                recentUploads.appendChild(row);
            });
            
            // Populate colleges table
            updateCollegesTable();
            
            // Populate courses table
            updateCoursesTable();
            
            // Populate subjects table
            updateSubjectsTable();
        }

        // Update colleges table
        function updateCollegesTable() {
            collegesTable.innerHTML = '';
            colleges.forEach(college => {
                const collegeCourses = courses.filter(course => course.collegeId === college.id);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${college.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${collegeCourses.length} courses</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        <button class="text-red-600 hover:text-red-900 delete-college" data-id="${college.id}">
                            <i class="fas fa-trash mr-1"></i> Delete
                        </button>
                    </td>
                `;
                collegesTable.appendChild(row);
            });
            
            // Add delete event listeners
            document.querySelectorAll('.delete-college').forEach(button => {
                button.addEventListener('click', () => {
                    const id = parseInt(button.getAttribute('data-id'));
                    deleteCollege(id);
                });
            });
        }

        // Update courses table
        function updateCoursesTable() {
            coursesTable.innerHTML = '';
            courses.forEach(course => {
                const college = colleges.find(c => c.id === course.collegeId);
                const courseSubjects = subjects.filter(subject => subject.courseId === course.id);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${course.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${college ? college.name : 'N/A'}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${courseSubjects.length} subjects</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        <button class="text-red-600 hover:text-red-900 delete-course" data-id="${course.id}">
                            <i class="fas fa-trash mr-1"></i> Delete
                        </button>
                    </td>
                `;
                coursesTable.appendChild(row);
            });
            
            // Add delete event listeners
            document.querySelectorAll('.delete-course').forEach(button => {
                button.addEventListener('click', () => {
                    const id = parseInt(button.getAttribute('data-id'));
                    deleteCourse(id);
                });
            });
        }

        // Update subjects table
        function updateSubjectsTable() {
            subjectsTable.innerHTML = '';
            subjects.forEach(subject => {
                const college = colleges.find(c => c.id === subject.collegeId);
                const course = courses.find(c => c.id === subject.courseId);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${subject.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${college ? college.name : 'N/A'}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${course ? course.name : 'N/A'}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        <button class="text-red-600 hover:text-red-900 delete-subject" data-id="${subject.id}">
                            <i class="fas fa-trash mr-1"></i> Delete
                        </button>
                    </td>
                `;
                subjectsTable.appendChild(row);
            });
            
            // Add delete event listeners
            document.querySelectorAll('.delete-subject').forEach(button => {
                button.addEventListener('click', () => {
                    const id = parseInt(button.getAttribute('data-id'));
                    deleteSubject(id);
                });
            });
        }

        // Add event listeners
        function addEventListeners() {
            // Admin login
            adminToggleBtn.addEventListener('click', () => {
                adminLoginModal.classList.remove('hidden');
            });
            
            cancelLoginBtn.addEventListener('click', () => {
                adminLoginModal.classList.add('hidden');
                passwordError.classList.add('hidden');
            });
            
            loginBtn.addEventListener('click', () => {
                if (adminPassword.value === 'pravat') {
                    isAdminLoggedIn = true;
                    adminPanel.classList.remove('hidden');
                    adminLoginModal.classList.add('hidden');
                    adminToggleBtn.innerHTML = '<i class="fas fa-user-shield mr-2"></i> Admin Mode';
                    localStorage.setItem(STORAGE_KEYS.ADMIN_STATE, 'true');
                    showToast('Admin login successful!', 'success');
                } else {
                    passwordError.classList.remove('hidden');
                }
            });
            
            logoutBtn.addEventListener('click', () => {
                isAdminLoggedIn = false;
                adminPanel.classList.add('hidden');
                adminToggleBtn.innerHTML = '<i class="fas fa-lock mr-2"></i> Admin Login';
                localStorage.setItem(STORAGE_KEYS.ADMIN_STATE, 'false');
                showToast('Admin logout successful!', 'info');
            });
            
            // College filter change
            collegeFilter.addEventListener('change', () => {
                const collegeId = parseInt(collegeFilter.value);
                updateCourseFilter(collegeId);
            });
            
            // Course filter change
            courseFilter.addEventListener('change', () => {
                const courseId = parseInt(courseFilter.value);
                updateSubjectFilter(courseId);
            });
            
            // College for course change (admin)
            collegeForCourse.addEventListener('change', () => {
                const collegeId = parseInt(collegeForCourse.value);
                // Courses are already updated when college changes
            });
            
            // College for subject change (admin)
            collegeForSubject.addEventListener('change', () => {
                const collegeId = parseInt(collegeForSubject.value);
                updateSubjectCourseFilter(collegeId);
            });
            
            // Upload college change
            uploadCollege.addEventListener('change', () => {
                const collegeId = parseInt(uploadCollege.value);
                updateUploadCourseFilter(collegeId);
            });
            
            // Upload course change
            uploadCourse.addEventListener('change', () => {
                const courseId = parseInt(uploadCourse.value);
                updateUploadSubjectFilter(courseId);
            });
            
            // Reset filters
            resetFiltersBtn.addEventListener('click', resetFilters);
            resetNoResultsBtn.addEventListener('click', resetFilters);
            
            // Search
            searchBtn.addEventListener('click', loadPapers);
            
            // View toggle
            gridViewBtn.addEventListener('click', showGridView);
            listViewBtn.addEventListener('click', showListView);
            
            // Admin tabs
            adminTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // Remove active class from all tabs
                    adminTabs.forEach(t => t.classList.remove('active', 'text-indigo-600', 'border-indigo-600'));
                    
                    // Add active class to clicked tab
                    tab.classList.add('active', 'text-indigo-600', 'border-indigo-600');
                    
                    // Hide all tab contents
                    tabContents.forEach(content => content.classList.remove('active'));
                    
                    // Show selected tab content
                    const tabId = tab.getAttribute('data-tab');
                    document.getElementById(`${tabId}Tab`).classList.add('active');
                });
            });
            
            // Add college
            addCollegeBtn.addEventListener('click', () => {
                const name = newCollegeName.value.trim();
                if (name) {
                    addCollege(name);
                    newCollegeName.value = '';
                    showToast('College added successfully!', 'success');
                } else {
                    showToast('Please enter a college name', 'error');
                }
            });
            
            // Add course
            addCourseBtn.addEventListener('click', () => {
                const collegeId = parseInt(collegeForCourse.value);
                const name = newCourseName.value.trim();
                
                if (collegeId && name) {
                    addCourse(collegeId, name);
                    newCourseName.value = '';
                    showToast('Course added successfully!', 'success');
                } else {
                    showToast('Please select a college and enter a course name', 'error');
                }
            });
            
            // Add subject
            addSubjectBtn.addEventListener('click', () => {
                const collegeId = parseInt(collegeForSubject.value);
                const courseId = parseInt(courseForSubject.value);
                const name = newSubjectName.value.trim();
                
                if (collegeId && courseId && name) {
                    addSubject(collegeId, courseId, name);
                    newSubjectName.value = '';
                    showToast('Subject added successfully!', 'success');
                } else {
                    showToast('Please select a college, course, and enter a subject name', 'error');
                }
            });
            
            // Add file
            addFileBtn.addEventListener('click', addFile);
            
            // Upload paper
            uploadPaperBtn.addEventListener('click', () => {
                const title = paperTitle.value.trim();
                const collegeId = parseInt(uploadCollege.value);
                const courseId = parseInt(uploadCourse.value);
                const subjectId = parseInt(uploadSubject.value);
                const year = parseInt(uploadYear.value);
                const semester = parseInt(uploadSemester.value);
                const link = fileLink.value.trim();
                
                if (!title) {
                    showToast('Please enter a paper title', 'error');
                    return;
                }
                
                if (!collegeId) {
                    showToast('Please select a college', 'error');
                    return;
                }
                
                if (!courseId) {
                    showToast('Please select a course', 'error');
                    return;
                }
                
                if (!subjectId) {
                    showToast('Please select a subject', 'error');
                    return;
                }
                
                if (!year) {
                    showToast('Please select a year', 'error');
                    return;
                }
                
                if (!semester) {
                    showToast('Please select a semester', 'error');
                    return;
                }
                
                if (!link || !link.includes('dl.surf')) {
                    showToast('Please enter a valid dl.surf file link', 'error');
                    return;
                }
                
                // Add new paper
                const newPaper = {
                    id: Date.now(),
                    title: title,
                    collegeId: collegeId,
                    courseId: courseId,
                    subjectId: subjectId,
                    year: year,
                    semester: semester,
                    file: link,
                    date: new Date().toISOString().split('T')[0],
                    content: `This is the content of the ${title} paper. In a real application, this would be the actual exam paper content.`
                };
                
                papers.push(newPaper);
                saveDataToStorage();
                
                // Reset form
                paperTitle.value = '';
                uploadCollege.value = '';
                uploadCourse.innerHTML = '<option value="">Select course</option>';
                uploadCourse.disabled = true;
                uploadSubject.innerHTML = '<option value="">Select subject</option>';
                uploadSubject.disabled = true;
                uploadYear.value = '';
                uploadSemester.value = '';
                fileLink.value = '';
                filePreview.innerHTML = '<p class="text-gray-500 italic">No file added yet</p>';
                
                // Show success message
                showToast('Paper uploaded successfully!', 'success');
                
                // Update UI
                updatePaperCounts();
                initAdminPanel();
                loadPapers();
            });
        }

        // Update course filter based on selected college
        function updateCourseFilter(collegeId) {
            courseFilter.innerHTML = '<option value="">Select course</option>';
            subjectFilter.innerHTML = '<option value="">Select subject</option>';
            subjectFilter.disabled = true;
            
            if (collegeId) {
                const collegeCourses = courses.filter(course => course.collegeId === collegeId);
                collegeCourses.forEach(course => {
                    const option = document.createElement('option');
                    option.value = course.id;
                    option.textContent = course.name;
                    courseFilter.appendChild(option);
                });
                courseFilter.disabled = false;
            } else {
                courseFilter.disabled = true;
            }
        }

        // Update subject filter based on selected course
        function updateSubjectFilter(courseId) {
            subjectFilter.innerHTML = '<option value="">Select subject</option>';
            
            if (courseId) {
                const courseSubjects = subjects.filter(subject => subject.courseId === courseId);
                courseSubjects.forEach(subject => {
                    const option = document.createElement('option');
                    option.value = subject.id;
                    option.textContent = subject.name;
                    subjectFilter.appendChild(option);
                });
                subjectFilter.disabled = false;
            } else {
                subjectFilter.disabled = true;
            }
        }

        // Update subject course filter (admin)
        function updateSubjectCourseFilter(collegeId) {
            courseForSubject.innerHTML = '<option value="">Select course</option>';
            courseForSubject.disabled = !collegeId;
            
            if (collegeId) {
                const collegeCourses = courses.filter(course => course.collegeId === collegeId);
                collegeCourses.forEach(course => {
                    const option = document.createElement('option');
                    option.value = course.id;
                    option.textContent = course.name;
                    courseForSubject.appendChild(option);
                });
            }
        }

        // Update upload course filter based on selected college
        function updateUploadCourseFilter(collegeId) {
            uploadCourse.innerHTML = '<option value="">Select course</option>';
            uploadSubject.innerHTML = '<option value="">Select subject</option>';
            uploadSubject.disabled = true;
            
            if (collegeId) {
                const collegeCourses = courses.filter(course => course.collegeId === collegeId);
                collegeCourses.forEach(course => {
                    const option = document.createElement('option');
                    option.value = course.id;
                    option.textContent = course.name;
                    uploadCourse.appendChild(option);
                });
                uploadCourse.disabled = false;
            } else {
                uploadCourse.disabled = true;
            }
        }

        // Update upload subject filter based on selected course
        function updateUploadSubjectFilter(courseId) {
            uploadSubject.innerHTML = '<option value="">Select subject</option>';
            
            if (courseId) {
                const courseSubjects = subjects.filter(subject => subject.courseId === courseId);
                courseSubjects.forEach(subject => {
                    const option = document.createElement('option');
                    option.value = subject.id;
                    option.textContent = subject.name;
                    uploadSubject.appendChild(option);
                });
                uploadSubject.disabled = false;
            } else {
                uploadSubject.disabled = true;
            }
        }

        // Reset all filters
        function resetFilters() {
            collegeFilter.value = '';
            courseFilter.innerHTML = '<option value="">Select course</option>';
            courseFilter.disabled = true;
            yearFilter.value = '';
            semesterFilter.value = '';
            subjectFilter.innerHTML = '<option value="">Select subject</option>';
            subjectFilter.disabled = true;
            loadPapers();
            showToast('Filters reset successfully', 'info');
        }

        // Show grid view
        function showGridView() {
            gridView.classList.remove('hidden');
            listView.classList.add('hidden');
            gridViewBtn.classList.add('bg-indigo-600', 'text-white');
            gridViewBtn.classList.remove('text-gray-900', 'bg-white');
            listViewBtn.classList.remove('bg-indigo-600', 'text-white');
            listViewBtn.classList.add('text-gray-900', 'bg-white');
        }

        // Show list view
        function showListView() {
            gridView.classList.add('hidden');
            listView.classList.remove('hidden');
            gridViewBtn.classList.remove('bg-indigo-600', 'text-white');
            gridViewBtn.classList.add('text-gray-900', 'bg-white');
            listViewBtn.classList.add('bg-indigo-600', 'text-white');
            listViewBtn.classList.remove('text-gray-900', 'bg-white');
        }

        // Load papers based on filters
        function loadPapers() {
            const collegeId = parseInt(collegeFilter.value);
            const courseId = parseInt(courseFilter.value);
            const year = parseInt(yearFilter.value);
            const semester = parseInt(semesterFilter.value);
            const subjectId = parseInt(subjectFilter.value);
            
            // Filter papers
            let filteredPapers = papers;
            
            if (collegeId) {
                filteredPapers = filteredPapers.filter(paper => paper.collegeId === collegeId);
            }
            
            if (courseId) {
                filteredPapers = filteredPapers.filter(paper => paper.courseId === courseId);
            }
            
            if (year) {
                filteredPapers = filteredPapers.filter(paper => paper.year === year);
            }
            
            if (semester) {
                filteredPapers = filteredPapers.filter(paper => paper.semester === semester);
            }
            
            if (subjectId) {
                filteredPapers = filteredPapers.filter(paper => paper.subjectId === subjectId);
            }
            
            // Display results
            if (filteredPapers.length === 0) {
                noResults.classList.remove('hidden');
                gridView.classList.add('hidden');
                listView.classList.add('hidden');
            } else {
                noResults.classList.add('hidden');
                renderPapers(filteredPapers);
            }
        }

        // Render papers in grid and list views
        function renderPapers(papersToRender) {
            // Clear existing papers
            gridView.innerHTML = '';
            listViewContent.innerHTML = '';
            
            papersToRender.forEach(paper => {
                const college = colleges.find(c => c.id === paper.collegeId);
                const course = courses.find(c => c.id === paper.courseId);
                const subject = subjects.find(s => s.id === paper.subjectId);
                
                // Grid view card
                const gridCard = document.createElement('div');
                gridCard.className = 'bg-white rounded-xl shadow-md overflow-hidden card-hover paper-card';
                gridCard.innerHTML = `
                    <div class="p-6">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="text-lg font-semibold text-gray-800 mb-1">${paper.title}</h3>
                                <p class="text-gray-600 text-sm mb-2">${college ? college.name : 'N/A'}</p>
                            </div>
                            <span class="bg-indigo-100 text-indigo-800 text-xs font-medium px-2.5 py-0.5 rounded">${paper.year}</span>
                        </div>
                        <div class="mt-4 mb-6">
                            <p class="text-gray-700 mb-1"><span class="font-medium">Course:</span> ${course ? course.name : 'N/A'}</p>
                            <p class="text-gray-700"><span class="font-medium">Subject:</span> ${subject ? subject.name : 'N/A'}</p>
                        </div>
                        <div class="flex justify-between items-center">
                            <button class="download-btn px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 flex items-center" data-id="${paper.id}">
                                <i class="fas fa-download mr-2"></i> Download
                            </button>
                            ${isAdminLoggedIn ? `
                            <button class="delete-btn px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 flex items-center" data-id="${paper.id}">
                                <i class="fas fa-trash mr-2"></i>
                            </button>
                            ` : ''}
                        </div>
                    </div>
                `;
                gridView.appendChild(gridCard);
                
                // List view row
                const listRow = document.createElement('tr');
                listRow.className = 'paper-list-item';
                listRow.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-gray-900">${paper.title}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${college ? college.name : 'N/A'}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${course ? course.name : 'N/A'}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${paper.year}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button class="download-btn px-3 py-1 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 flex items-center" data-id="${paper.id}">
                            <i class="fas fa-download mr-1"></i> Download
                        </button>
                        ${isAdminLoggedIn ? `
                        <button class="delete-btn px-3 py-1 bg-red-600 text-white rounded-md hover:bg-red-700 ml-2" data-id="${paper.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                        ` : ''}
                    </td>
                `;
                listViewContent.appendChild(listRow);
            });
            
            // Add event listeners to download buttons
            document.querySelectorAll('.download-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    e.preventDefault();
                    const paperId = parseInt(button.getAttribute('data-id'));
                    const paper = papers.find(p => p.id === paperId);
                    if (paper) {
                        downloadPaper(paper);
                    }
                });
            });
            
            // Add event listeners to delete buttons (admin only)
            if (isAdminLoggedIn) {
                document.querySelectorAll('.delete-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        e.preventDefault();
                        const paperId = parseInt(button.getAttribute('data-id'));
                        if (confirm('Are you sure you want to delete this paper?')) {
                            deletePaper(paperId);
                        }
                    });
                });
            }
        }

        // Download paper
        function downloadPaper(paper) {
            // Create a blob from the paper content
            const blob = new Blob([paper.content], { type: 'text/plain' });
            
            // Create a temporary URL for the blob
            const url = URL.createObjectURL(blob);
            
            // Create a temporary link element
            const a = document.createElement('a');
            a.href = url;
            a.download = paper.file;
            
            // Append the link to the body and click it
            document.body.appendChild(a);
            a.click();
            
            // Clean up
            setTimeout(() => {
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 100);
            
            showToast(`Downloading: ${paper.title}`, 'info');
        }

        // Update paper counts
        function updatePaperCounts() {
            totalPapers.textContent = papers.length;
        }

        // Add a new college
        function addCollege(name) {
            const newCollege = {
                id: Date.now(),
                name: name
            };
            
            colleges.push(newCollege);
            saveDataToStorage();
            
            // Update UI
            const option = document.createElement('option');
            option.value = newCollege.id;
            option.textContent = name;
            collegeFilter.appendChild(option);
            uploadCollege.appendChild(option.cloneNode(true));
            collegeForCourse.appendChild(option.cloneNode(true));
            collegeForSubject.appendChild(option.cloneNode(true));
            
            updateCollegesTable();
            totalColleges.textContent = colleges.length;
        }

        // Delete a college
        function deleteCollege(id) {
            colleges = colleges.filter(college => college.id !== id);
            
            // Also delete related courses and subjects
            courses = courses.filter(course => course.collegeId !== id);
            subjects = subjects.filter(subject => subject.collegeId !== id);
            
            // Also delete papers from this college
            papers = papers.filter(paper => paper.collegeId !== id);
            
            saveDataToStorage();
            
            // Update UI
            updateCollegesTable();
            updateCoursesTable();
            updateSubjectsTable();
            updatePaperCounts();
            initFilters();
            loadPapers();
            showToast('College deleted successfully!', 'success');
        }

        // Add a new course
        function addCourse(collegeId, name) {
            const newCourse = {
                id: Date.now(),
                collegeId: collegeId,
                name: name
            };
            
            courses.push(newCourse);
            saveDataToStorage();
            
            // Update UI
            updateCoursesTable();
            
            // Also update course filters
            if (parseInt(collegeFilter.value) === collegeId) {
                const option = document.createElement('option');
                option.value = newCourse.id;
                option.textContent = name;
                courseFilter.appendChild(option);
            }
            
            if (parseInt(uploadCollege.value) === collegeId) {
                const option = document.createElement('option');
                option.value = newCourse.id;
                option.textContent = name;
                uploadCourse.appendChild(option);
            }
        }

        // Delete a course
        function deleteCourse(id) {
            courses = courses.filter(course => course.id !== id);
            
            // Also delete related subjects
            subjects = subjects.filter(subject => subject.courseId !== id);
            
            // Also delete papers from this course
            papers = papers.filter(paper => paper.courseId !== id);
            
            saveDataToStorage();
            
            // Update UI
            updateCoursesTable();
            updateSubjectsTable();
            updatePaperCounts();
            initFilters();
            loadPapers();
            showToast('Course deleted successfully!', 'success');
        }

        // Add a new subject
        function addSubject(collegeId, courseId, name) {
            const newSubject = {
                id: Date.now(),
                collegeId: collegeId,
                courseId: courseId,
                name: name
            };
            
            subjects.push(newSubject);
            saveDataToStorage();
            
            // Update UI
            updateSubjectsTable();
            
            // Also update subject filters
            if (parseInt(collegeFilter.value) === collegeId && parseInt(courseFilter.value) === courseId) {
                const option = document.createElement('option');
                option.value = newSubject.id;
                option.textContent = name;
                subjectFilter.appendChild(option);
            }
            
            if (parseInt(uploadCollege.value) === collegeId && parseInt(uploadCourse.value) === courseId) {
                const option = document.createElement('option');
                option.value = newSubject.id;
                option.textContent = name;
                uploadSubject.appendChild(option);
            }
        }

        // Delete a subject
        function deleteSubject(id) {
            subjects = subjects.filter(subject => subject.id !== id);
            
            // Also delete papers for this subject
            papers = papers.filter(paper => paper.subjectId !== id);
            
            saveDataToStorage();
            
            // Update UI
            updateSubjectsTable();
            updatePaperCounts();
            initFilters();
            loadPapers();
            showToast('Subject deleted successfully!', 'success');
        }

        // Delete a paper
        function deletePaper(id) {
            papers = papers.filter(paper => paper.id !== id);
            saveDataToStorage();
            
            // Update UI
            updatePaperCounts();
            loadPapers();
            initAdminPanel();
            showToast('Paper deleted successfully!', 'success');
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>